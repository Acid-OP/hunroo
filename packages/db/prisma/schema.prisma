generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      UserRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  jobSeekerProfile   JobSeekerProfile?
  jobProviderProfile JobProviderProfile?

  @@map("users")
}

enum UserRole {
  JOB_SEEKER
  JOB_PROVIDER
}

model JobSeekerProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  name      String
  address   String?
  phone     String?
  education String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user             User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  skills           UserSkill[]
  employmentHistory EmploymentHistory[]
  references       Reference[]
  applications     Application[]

  @@map("job_seeker_profiles")
}

model JobProviderProfile {
  id                 String   @id @default(uuid())
  userId             String   @unique
  companyName        String
  companyDescription String?
  companyWebsite     String?
  contactInfo        String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relations
  user User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobs Job[]

  @@map("job_provider_profiles")
}

model Skill {
  id                  String   @id @default(uuid())
  skillName           String   @unique
  requiresCertificate Boolean  @default(false)
  createdAt           DateTime @default(now())

  // Relations
  userSkills UserSkill[]
  jobs       JobSkill[]

  @@map("skills")
}

model UserSkill {
  id                   String   @id @default(uuid())
  jobSeekerProfileId   String
  skillId              String
  certificateUrl       String? 
  createdAt            DateTime @default(now())

  // Relations
  jobSeekerProfile JobSeekerProfile @relation(fields: [jobSeekerProfileId], references: [id], onDelete: Cascade)
  skill            Skill            @relation(fields: [skillId], references: [id])

  @@unique([jobSeekerProfileId, skillId])
  @@map("user_skills")
}

model EmploymentHistory {
  id                   String   @id @default(uuid())
  jobSeekerProfileId   String
  companyName          String
  duration             String 
  description          String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  jobSeekerProfile JobSeekerProfile @relation(fields: [jobSeekerProfileId], references: [id], onDelete: Cascade)

  @@map("employment_history")
}

model Reference {
  id                   String   @id @default(uuid())
  jobSeekerProfileId   String
  name                 String
  contact              String
  description          String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  jobSeekerProfile JobSeekerProfile @relation(fields: [jobSeekerProfileId], references: [id], onDelete: Cascade)

  @@map("references")
}

model Job {
  id                   String         @id @default(uuid())
  jobProviderProfileId String
  title                String
  description          String
  pay                  Float
  employmentType       EmploymentType
  location             String
  duration             String? 
  status               JobStatus      @default(OPEN)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt

  // Relations
  jobProviderProfile JobProviderProfile @relation(fields: [jobProviderProfileId], references: [id], onDelete: Cascade)
  requiredSkills     JobSkill[]
  applications       Application[]

  @@map("jobs")
}

enum EmploymentType {
  PER_DAY
  PER_PROJECT
}

enum JobStatus {
  OPEN
  CLOSED
}

model JobSkill {
  id        String   @id @default(uuid())
  jobId     String
  skillId   String
  createdAt DateTime @default(now())

  // Relations
  job   Job   @relation(fields: [jobId], references: [id], onDelete: Cascade)
  skill Skill @relation(fields: [skillId], references: [id])

  @@unique([jobId, skillId])
  @@map("job_skills")
}

model Application {
  id                   String            @id @default(uuid())
  jobId                String
  jobSeekerProfileId   String
  status               ApplicationStatus @default(PENDING)
  appliedAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt

  // Relations
  job              Job              @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobSeekerProfile JobSeekerProfile @relation(fields: [jobSeekerProfileId], references: [id], onDelete: Cascade)

  @@unique([jobId, jobSeekerProfileId]) 
  @@map("applications")
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  ACCEPTED
  REJECTED
}